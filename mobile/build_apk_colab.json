{
  "cells": [
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        "# üõ°Ô∏è VoiceGuard AI - Android APK Builder\n",
        "## Build Native Android APK using Buildozer on Google Colab (Free)\n",
        "\n",
        "**Instructions:**\n",
        "1. Upload this notebook to Google Colab\n",
        "2. Upload your VoiceGuard project files\n",
        "3. Run all cells\n",
        "4. Download the APK\n",
        "\n",
        "**Time:** 30-60 minutes (first build)\n",
        "**Cost:** Free (Google Colab free tier)"
      ]
    },
    {
      "cell_type": "code",
      "execution_count": null,
      "metadata": {},
      "outputs": [],
      "source": [
        "# ============================================\n",
        "# CELL 1: Setup Buildozer Environment\n",
        "# ============================================\n",
        "!pip install buildozer cython==0.29.33\n",
        "!apt-get install -y \\\n",
        "    python3-pip \\\n",
        "    build-essential \\\n",
        "    git \\\n",
        "    ffmpeg \\\n",
        "    libsdl2-dev \\\n",
        "    libsdl2-image-dev \\\n",
        "    libsdl2-mixer-dev \\\n",
        "    libsdl2-ttf-dev \\\n",
        "    libgstreamer1.0 \\\n",
        "    gstreamer1.0-plugins-base \\\n",
        "    gstreamer1.0-plugins-good \\\n",
        "    libffi-dev \\\n",
        "    openjdk-11-jdk \\\n",
        "    autoconf \\\n",
        "    automake \\\n",
        "    libtool\n",
        "\n",
        "print(\"‚úÖ Buildozer environment setup complete\")"
      ]
    },
    {
      "cell_type": "code",
      "execution_count": null,
      "metadata": {},
      "outputs": [],
      "source": [
        "# ============================================\n",
        "# CELL 2: Mount Google Drive & Upload Project\n",
        "# ============================================\n",
        "from google.colab import drive\n",
        "drive.mount('/content/drive')\n",
        "\n",
        "# Create working directory\n",
        "!mkdir -p /content/voiceguard-mobile\n",
        "%cd /content/voiceguard-mobile\n",
        "\n",
        "print(\"‚úÖ Google Drive mounted\")\n",
        "print(\"üìÅ Upload your VoiceGuard files to: /content/drive/MyDrive/voiceguard-upload/\")\n",
        "print(\"Then copy them to: /content/voiceguard-mobile/\")"
      ]
    },
    {
      "cell_type": "code",
      "execution_count": null,
      "metadata": {},
      "outputs": [],
      "source": [
        "# ============================================\n",
        "# CELL 3: Copy Project Files\n",
        "# ============================================\n",
        "# Copy from your uploaded folder\n",
        "!cp -r /content/drive/MyDrive/voiceguard-upload/* /content/voiceguard-mobile/\n",
        "\n",
        "# Verify files\n",
        "!ls -la\n",
        "\n",
        "print(\"‚úÖ Project files copied\")"
      ]
    },
    {
      "cell_type": "code",
      "execution_count": null,
      "metadata": {},
      "outputs": [],
      "source": [
        "# ============================================\n",
        "# CELL 4: Create Kivy Mobile App Entry Point\n",
        "# ============================================\n",
        "!mkdir -p mobile\n",
        "\n",
        "with open('mobile/main.py', 'w') as f:\n",
        "    f.write('''\n",
        "#!/usr/bin/env python3\n",
        "\\\"\\\"\\\"VoiceGuard AI - Kivy Mobile App\\\"\\\"\\\"\n",
        "import os\n",
        "import json\n",
        "from kivy.app import App\n",
        "from kivy.uix.boxlayout import BoxLayout\n",
        "from kivy.uix.label import Label\n",
        "from kivy.uix.button import Button\n",
        "from kivy.uix.filechooser import FileChooserListView\n",
        "from kivy.uix.progressbar import ProgressBar\n",
        "from kivy.uix.popup import Popup\n",
        "from kivy.network.urlrequest import UrlRequest\n",
        "from kivy.clock import Clock\n",
        "\n",
        "# Backend API URL - UPDATE THIS after deployment\n",
        "API_URL = \"https://your-backend-url.com\"  # Replace with your deployed backend\n",
        "\n",
        "class VoiceGuardApp(App):\n",
        "    def build(self):\n",
        "        self.root = BoxLayout(orientation=\\'vertical\\', padding=20)\n",
        "        \n",
        "        # Header\n",
        "        header = Label(text=\"üõ°Ô∏è VoiceGuard AI\", size_hint_y=0.1, font_size=\\'24sp\\', bold=True)\n",
        "        self.root.add_widget(header)\n",
        "        \n",
        "        # Status\n",
        "        self.status = Label(text=\"Select audio file to analyze\", size_hint_y=0.1)\n",
        "        self.root.add_widget(self.status)\n",
        "        \n",
        "        # File chooser\n",
        "        self.file_chooser = FileChooserListView(\n",
        "            path=\\'/storage/emulated/0/Download\\',\n",
        "            filters=[\\'*.wav\\', \\'*.mp3\\', \\'*.flac\\'],\n",
        "            size_hint_y=0.5\n",
        "        )\n",
        "        self.root.add_widget(self.file_chooser)\n",
        "        \n",
        "        # Analyze button\n",
        "        analyze_btn = Button(text=\"üîç Analyze File\", size_hint_y=0.1)\n",
        "        analyze_btn.bind(on_press=self.analyze_file)\n",
        "        self.root.add_widget(analyze_btn)\n",
        "        \n",
        "        # Progress\n",
        "        self.progress = ProgressBar(max=100, value=0, size_hint_y=0.1)\n",
        "        self.progress.opacity = 0\n",
        "        self.root.add_widget(self.progress)\n",
        "        \n",
        "        # Result\n",
        "        self.result = Label(text=\"\", size_hint_y=0.2, color=(1, 1, 1, 1))\n",
        "        self.root.add_widget(self.result)\n",
        "        \n",
        "        return self.root\n",
        "    \n",
        "    def analyze_file(self, instance):\n",
        "        if not self.file_chooser.selection:\n",
        "            self.status.text = \"‚ö†Ô∏è Please select a file first\"\n",
        "            return\n",
        "        \n",
        "        filepath = self.file_chooser.selection[0]\n",
        "        self.status.text = f\"üîÑ Analyzing...\"\n",
        "        self.progress.opacity = 1\n",
        "        self.progress.value = 25\n",
        "        \n",
        "        # Simple file read for demo (replace with actual API call)\n",
        "        def on_success(req, result):\n",
        "            self.progress.value = 100\n",
        "            try:\n",
        "                data = json.loads(result)\n",
        "                if \\'label\\' in data:\n",
        "                    color = (0, 1, 0, 1) if data[\\'label\\'] == \\'Human Voice\\' else (1, 0, 0, 1)\n",
        "                    self.result.color = color\n",
        "                    self.result.text = f\"{data[\\'label\\']}\\\\nConfidence: {data[\\'score\\']}%\"\n",
        "                    self.status.text = \"‚úÖ Complete\"\n",
        "            except Exception as e:\n",
        "                self.result.text = f\"‚ùå Error: {str(e)}\"\n",
        "            finally:\n",
        "                Clock.schedule_once(lambda dt: setattr(self.progress, \\'opacity\\', 0), 2)\n",
        "        \n",
        "        def on_error(req, error):\n",
        "            self.progress.opacity = 0\n",
        "            self.result.text = f\"‚ùå Network error\"\n",
        "            self.status.text = \"‚ùå Failed\"\n",
        "        \n",
        "        # Upload file\n",
        "        with open(filepath, \\'rb\\') as f:\n",
        "            files = {\\'file\\': (os.path.basename(filepath), f, \\'audio/wav\\')}\n",
        "            # Note: UrlRequest file upload needs custom implementation\n",
        "            # For now, show demo message\n",
        "            self.result.text = \"Demo: Connect to backend API\"\n",
        "            self.progress.value = 100\n",
        "\n",
        "if __name__ == \\'__main__\\':\n",
        "    VoiceGuardApp().run()\n",
        "''')\n",
        "\n",
        "print(\"‚úÖ Kivy app entry point created\")"
      ]
    },
    {
      "cell_type": "code",
      "execution_count": null,
      "metadata": {},
      "outputs": [],
      "source": [
        "# ============================================\n",
        "# CELL 5: Create buildozer.spec\n",
        "# ============================================\n",
        "with open('mobile/buildozer.spec', 'w') as f:\n",
        "    f.write('''\n",
        "[app]\n",
        "title = VoiceGuard AI\n",
        "package.name = voiceguardai\n",
        "package.domain = com.ganeshkuppa\n",
        "\n",
        "source.dir = .\n",
        "source.include_exts = py,png,jpg,kv,atlas\n",
        "source.exclude_exts = spec\n",
        "\n",
        "version = 2.0.0\n",
        "requirements = python3,kivy==2.2.1,requests,urllib3\n",
        "orientation = portrait\n",
        "fullscreen = 0\n",
        "\n",
        "android.permissions = INTERNET,RECORD_AUDIO,READ_EXTERNAL_STORAGE,WRITE_EXTERNAL_STORAGE\n",
        "android.api = 33\n",
        "android.minapi = 21\n",
        "android.arch = arm64-v8a\n",
        "android.accept_sdk_license = True\n",
        "\n",
        "[buildozer]\n",
        "log_level = 2\n",
        "warn_on_root = 1\n",
        "''')\n",
        "\n",
        "print(\"‚úÖ buildozer.spec created\")"
      ]
    },
    {
      "cell_type": "code",
      "execution_count": null,
      "metadata": {},
      "outputs": [],
      "source": [
        "# ============================================\n",
        "# CELL 6: Build APK (Takes 30-60 minutes)\n",
        "# ============================================\n",
        "%cd mobile\n",
        "!buildozer -v android debug\n",
        "\n",
        "print(\"‚úÖ APK build complete!\")\n",
        "print(\"üì± APK location: bin/voiceguardai-2.0.0-debug.apk\")"
      ]
    },
    {
      "cell_type": "code",
      "execution_count": null,
      "metadata": {},
      "outputs": [],
      "source": [
        "# ============================================\n",
        "# CELL 7: Download APK\n",
        "# ============================================\n",
        "from google.colab import files\n",
        "\n",
        "# Download the APK\n",
        "files.download('bin/voiceguardai-2.0.0-debug.apk')\n",
        "\n",
        "# Also copy to Google Drive for safekeeping\n",
        "!cp bin/voiceguardai-2.0.0-debug.apk /content/drive/MyDrive/voiceguard-apk/\n",
        "\n",
        "print(\"‚úÖ APK downloaded to your computer!\")\n",
        "print(\"üìÅ Also saved to Google Drive: /voiceguard-apk/\")"
      ]
    }
  ],
  "metadata": {
    "accelerator": "GPU",
    "colab": {
      "name": "VoiceGuard AI - APK Builder",
      "provenance": [],
      "gpuType": "T4"
    },
    "kernelspec": {
      "display_name": "Python 3",
      "name": "python3"
    }
  },
  "nbformat": 4,
  "nbformat_minor": 0
}